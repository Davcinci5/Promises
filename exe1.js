if (!Promise.allSettled) {
   Promise.allSettled = promises =>
     Promise.all(
       promises.map((promise) =>
         promise
           .then(value => ({
             status: "fulfilled",
             value,
           }))
           .catch(reason => ({
             status: "rejected",
             reason,
           }))
       )
     );
 }

const taskFactorySample = (delay, resolve, val) => 
       () => new Promise((res, rej)=>setTimeout(resolve?res:rej,delay, val))

const tasks6 = [
   taskFactorySample(500,true, 1),
   taskFactorySample(1000,true, 2),
   taskFactorySample(5000,false, 'error'),
   taskFactorySample(2000,true, 4),
   taskFactorySample(1000,false, 'error'),
   taskFactorySample(1000,false, 'error'),
];
const tasks10 = [taskFactorySample(4674,true, 0),taskFactorySample(2173,false, 'error'),taskFactorySample(4996,true, 2),taskFactorySample(932,false, 'error'),taskFactorySample(926,true, 4),taskFactorySample(5093,false, 'error'),taskFactorySample(3246,true, 6),taskFactorySample(4589,false, 'error'),taskFactorySample(2075,true, 8),taskFactorySample(1461,false, 'error')];
const tasks500 = [taskFactorySample(746,true, 0),taskFactorySample(2036,false, 'error'),taskFactorySample(5115,true, 2),taskFactorySample(4045,false, 'error'),taskFactorySample(5248,true, 4),taskFactorySample(1442,false, 'error'),taskFactorySample(4017,true, 6),taskFactorySample(4204,false, 'error'),taskFactorySample(1827,true, 8),taskFactorySample(1693,false, 'error'),taskFactorySample(732,true, 10),taskFactorySample(2201,false, 'error'),taskFactorySample(4350,true, 12),taskFactorySample(3458,false, 'error'),taskFactorySample(2092,true, 14),taskFactorySample(4676,false, 'error'),taskFactorySample(1549,true, 16),taskFactorySample(2511,false, 'error'),taskFactorySample(1683,true, 18),taskFactorySample(4582,false, 'error'),taskFactorySample(1600,true, 20),taskFactorySample(1203,false, 'error'),taskFactorySample(1115,true, 22),taskFactorySample(4172,false, 'error'),taskFactorySample(1028,true, 24),taskFactorySample(3267,false, 'error'),taskFactorySample(570,true, 26),taskFactorySample(3653,false, 'error'),taskFactorySample(2774,true, 28),taskFactorySample(5405,false, 'error'),taskFactorySample(3474,true, 30),taskFactorySample(2232,false, 'error'),taskFactorySample(2100,true, 32),taskFactorySample(3138,false, 'error'),taskFactorySample(2092,true, 34),taskFactorySample(5087,false, 'error'),taskFactorySample(729,true, 36),taskFactorySample(585,false, 'error'),taskFactorySample(1757,true, 38),taskFactorySample(4864,false, 'error'),taskFactorySample(3604,true, 40),taskFactorySample(5210,false, 'error'),taskFactorySample(1877,true, 42),taskFactorySample(1129,false, 'error'),taskFactorySample(3421,true, 44),taskFactorySample(4733,false, 'error'),taskFactorySample(4518,true, 46),taskFactorySample(777,false, 'error'),taskFactorySample(1312,true, 48),taskFactorySample(4387,false, 'error'),taskFactorySample(3792,true, 50),taskFactorySample(3873,false, 'error'),taskFactorySample(3038,true, 52),taskFactorySample(2198,false, 'error'),taskFactorySample(2494,true, 54),taskFactorySample(3339,false, 'error'),taskFactorySample(855,true, 56),taskFactorySample(5027,false, 'error'),taskFactorySample(955,true, 58),taskFactorySample(5389,false, 'error'),taskFactorySample(1539,true, 60),taskFactorySample(4209,false, 'error'),taskFactorySample(4297,true, 62),taskFactorySample(3591,false, 'error'),taskFactorySample(1292,true, 64),taskFactorySample(4316,false, 'error'),taskFactorySample(2333,true, 66),taskFactorySample(2133,false, 'error'),taskFactorySample(948,true, 68),taskFactorySample(1053,false, 'error'),taskFactorySample(597,true, 70),taskFactorySample(1729,false, 'error'),taskFactorySample(5439,true, 72),taskFactorySample(4108,false, 'error'),taskFactorySample(3327,true, 74),taskFactorySample(1775,false, 'error'),taskFactorySample(2992,true, 76),taskFactorySample(573,false, 'error'),taskFactorySample(1436,true, 78),taskFactorySample(1132,false, 'error'),taskFactorySample(2879,true, 80),taskFactorySample(2053,false, 'error'),taskFactorySample(3612,true, 82),taskFactorySample(1573,false, 'error'),taskFactorySample(2225,true, 84),taskFactorySample(2253,false, 'error'),taskFactorySample(972,true, 86),taskFactorySample(4165,false, 'error'),taskFactorySample(3317,true, 88),taskFactorySample(2986,false, 'error'),taskFactorySample(3417,true, 90),taskFactorySample(3802,false, 'error'),taskFactorySample(3386,true, 92),taskFactorySample(1317,false, 'error'),taskFactorySample(5356,true, 94),taskFactorySample(3174,false, 'error'),taskFactorySample(610,true, 96),taskFactorySample(2110,false, 'error'),taskFactorySample(4893,true, 98),taskFactorySample(3386,false, 'error'),taskFactorySample(2523,true, 100),taskFactorySample(4211,false, 'error'),taskFactorySample(2250,true, 102),taskFactorySample(4955,false, 'error'),taskFactorySample(1164,true, 104),taskFactorySample(1058,false, 'error'),taskFactorySample(2298,true, 106),taskFactorySample(1123,false, 'error'),taskFactorySample(608,true, 108),taskFactorySample(1612,false, 'error'),taskFactorySample(2748,true, 110),taskFactorySample(1204,false, 'error'),taskFactorySample(5176,true, 112),
                  taskFactorySample(880,false, 'error'),taskFactorySample(3655,true, 114),taskFactorySample(3551,false, 'error'),taskFactorySample(2503,true, 116),taskFactorySample(3058,false, 'error'),taskFactorySample(2340,true, 118),taskFactorySample(1684,false, 'error'),taskFactorySample(1336,true, 120),taskFactorySample(2716,false, 'error'),taskFactorySample(5251,true, 122),taskFactorySample(2432,false, 'error'),taskFactorySample(4921,true, 124),taskFactorySample(1898,false, 'error'),taskFactorySample(2080,true, 126),taskFactorySample(3579,false, 'error'),taskFactorySample(3225,true, 128),taskFactorySample(1507,false, 'error'),taskFactorySample(2346,true, 130),taskFactorySample(4464,false, 'error'),taskFactorySample(3417,true, 132),taskFactorySample(5468,false, 'error'),taskFactorySample(3705,true, 134),taskFactorySample(5363,false, 'error'),taskFactorySample(1229,true, 136),taskFactorySample(944,false, 'error'),taskFactorySample(1390,true, 138),taskFactorySample(1068,false, 'error'),taskFactorySample(3628,true, 140),taskFactorySample(4155,false, 'error'),taskFactorySample(5329,true, 142),taskFactorySample(2436,false, 'error'),taskFactorySample(3349,true, 144),taskFactorySample(2123,false, 'error'),taskFactorySample(1556,true, 146),taskFactorySample(2728,false, 'error'),taskFactorySample(655,true, 148),taskFactorySample(1416,false, 'error'),taskFactorySample(5277,true, 150),taskFactorySample(5028,false, 'error'),taskFactorySample(3463,true, 152),taskFactorySample(3582,false, 'error'),taskFactorySample(504,true, 154),taskFactorySample(3139,false, 'error'),taskFactorySample(1093,true, 156),taskFactorySample(3619,false, 'error'),taskFactorySample(4993,true, 158),taskFactorySample(584,false, 'error'),taskFactorySample(3391,true, 160),taskFactorySample(1138,false, 'error'),taskFactorySample(2612,true, 162),taskFactorySample(3855,false, 'error'),taskFactorySample(1916,true, 164),taskFactorySample(5045,false, 'error'),taskFactorySample(3959,true, 166),taskFactorySample(1554,false, 'error'),taskFactorySample(3941,true, 168),taskFactorySample(3201,false, 'error'),taskFactorySample(1203,true, 170),taskFactorySample(1998,false, 'error'),taskFactorySample(3290,true, 172),taskFactorySample(2283,false, 'error'),taskFactorySample(4927,true, 174),taskFactorySample(600,false, 'error'),taskFactorySample(1198,true, 176),taskFactorySample(1489,false, 'error'),taskFactorySample(1421,true, 178),taskFactorySample(3047,false, 'error'),taskFactorySample(1385,true, 180),taskFactorySample(1977,false, 'error'),taskFactorySample(4684,true, 182),taskFactorySample(2454,false, 'error'),taskFactorySample(2278,true, 184),taskFactorySample(1924,false, 'error'),taskFactorySample(4904,true, 186),taskFactorySample(3987,false, 'error'),taskFactorySample(4110,true, 188),taskFactorySample(1660,false, 'error'),taskFactorySample(4144,true, 190),taskFactorySample(3477,false, 'error'),taskFactorySample(5016,true, 192),taskFactorySample(3284,false, 'error'),taskFactorySample(3227,true, 194),taskFactorySample(2921,false, 'error'),taskFactorySample(3064,true, 196),taskFactorySample(542,false, 'error'),taskFactorySample(513,true, 198),taskFactorySample(1118,false, 'error'),taskFactorySample(5292,true, 200),taskFactorySample(1654,false, 'error'),taskFactorySample(1556,true, 202),taskFactorySample(2103,false, 'error'),taskFactorySample(1023,true, 204),taskFactorySample(5096,false, 'error'),taskFactorySample(1348,true, 206),taskFactorySample(2795,false, 'error'),taskFactorySample(1034,true, 208),taskFactorySample(4337,false, 'error'),taskFactorySample(1280,true, 210),taskFactorySample(1559,false, 'error'),taskFactorySample(4326,true, 212),taskFactorySample(5469,false, 'error'),taskFactorySample(1756,true, 214),taskFactorySample(817,false, 'error'),taskFactorySample(4131,true, 216),taskFactorySample(2088,false, 'error'),taskFactorySample(4469,true, 218),taskFactorySample(1073,false, 'error'),taskFactorySample(5088,true, 220),taskFactorySample(5039,false, 'error'),taskFactorySample(3610,true, 222),taskFactorySample(3234,false, 'error'),taskFactorySample(4984,true, 224),taskFactorySample(2820,false, 'error'),taskFactorySample(2288,true, 226),taskFactorySample(4827,false, 'error'),taskFactorySample(5336,true, 228),taskFactorySample(1639,false, 'error'),taskFactorySample(2653,true, 230),taskFactorySample(740,false, 'error'),taskFactorySample(2823,true, 232),taskFactorySample(1702,false, 'error'),taskFactorySample(1852,true, 234),taskFactorySample(4557,false, 'error'),taskFactorySample(1943,true, 236),taskFactorySample(2302,false, 'error'),taskFactorySample(1199,true, 238),taskFactorySample(4406,false, 'error'),taskFactorySample(3766,true, 240),taskFactorySample(1159,false, 'error'),taskFactorySample(4241,true, 242),taskFactorySample(4871,false, 'error'),taskFactorySample(3761,true, 244),taskFactorySample(5394,false, 'error'),taskFactorySample(1347,true, 246),taskFactorySample(1816,false, 'error'),taskFactorySample(4088,true, 248),taskFactorySample(2283,false, 'error'),taskFactorySample(3481,true, 250),taskFactorySample(673,false, 'error'),taskFactorySample(4932,true, 252),taskFactorySample(4543,false, 'error'),taskFactorySample(622,true, 254),taskFactorySample(2649,false, 'error'),taskFactorySample(2516,true, 256),taskFactorySample(3478,false, 'error'),taskFactorySample(3097,true, 258),taskFactorySample(3927,false, 'error'),taskFactorySample(3543,true, 260),taskFactorySample(5017,false, 'error'),taskFactorySample(4694,true, 262),taskFactorySample(5103,false, 'error'),taskFactorySample(1197,true, 264),taskFactorySample(954,false, 'error'),taskFactorySample(3818,true, 266),taskFactorySample(1749,false, 'error'),taskFactorySample(2925,true, 268),taskFactorySample(5164,false, 'error'),taskFactorySample(709,true, 270),taskFactorySample(3176,false, 'error'),taskFactorySample(4983,true, 272),taskFactorySample(2223,false, 'error'),taskFactorySample(2064,true, 274),
                  taskFactorySample(5139,false, 'error'),taskFactorySample(645,true, 276),taskFactorySample(1840,false, 'error'),taskFactorySample(4062,true, 278),taskFactorySample(2511,false, 'error'),taskFactorySample(3051,true, 280),taskFactorySample(5391,false, 'error'),taskFactorySample(2281,true, 282),taskFactorySample(1928,false, 'error'),taskFactorySample(5130,true, 284),taskFactorySample(4083,false, 'error'),taskFactorySample(2999,true, 286),taskFactorySample(4965,false, 'error'),taskFactorySample(4058,true, 288),taskFactorySample(676,false, 'error'),taskFactorySample(4979,true, 290),taskFactorySample(1187,false, 'error'),taskFactorySample(5174,true, 292),taskFactorySample(4843,false, 'error'),taskFactorySample(2016,true, 294),taskFactorySample(5447,false, 'error'),taskFactorySample(4961,true, 296),taskFactorySample(5289,false, 'error'),taskFactorySample(4836,true, 298),taskFactorySample(3714,false, 'error'),taskFactorySample(3348,true, 300),taskFactorySample(4316,false, 'error'),taskFactorySample(2734,true, 302),taskFactorySample(3322,false, 'error'),taskFactorySample(3522,true, 304),taskFactorySample(2581,false, 'error'),taskFactorySample(4326,true, 306),taskFactorySample(1481,false, 'error'),taskFactorySample(4979,true, 308),taskFactorySample(1779,false, 'error'),taskFactorySample(2947,true, 310),taskFactorySample(851,false, 'error'),taskFactorySample(4431,true, 312),taskFactorySample(1247,false, 'error'),taskFactorySample(1821,true, 314),taskFactorySample(3036,false, 'error'),taskFactorySample(2349,true, 316),taskFactorySample(3815,false, 'error'),taskFactorySample(3094,true, 318),taskFactorySample(5198,false, 'error'),taskFactorySample(3588,true, 320),taskFactorySample(2238,false, 'error'),taskFactorySample(2443,true, 322),taskFactorySample(3131,false, 'error'),taskFactorySample(3517,true, 324),taskFactorySample(5068,false, 'error'),taskFactorySample(1732,true, 326),taskFactorySample(1861,false, 'error'),taskFactorySample(2376,true, 328),taskFactorySample(2621,false, 'error'),taskFactorySample(5302,true, 330),taskFactorySample(981,false, 'error'),taskFactorySample(4518,true, 332),taskFactorySample(5149,false, 'error'),taskFactorySample(4525,true, 334),taskFactorySample(1907,false, 'error'),taskFactorySample(665,true, 336),taskFactorySample(1726,false, 'error'),taskFactorySample(2865,true, 338),taskFactorySample(5072,false, 'error'),taskFactorySample(4708,true, 340),taskFactorySample(2508,false, 'error'),taskFactorySample(2062,true, 342),taskFactorySample(1057,false, 'error'),taskFactorySample(4030,true, 344),taskFactorySample(4142,false, 'error'),taskFactorySample(2768,true, 346),taskFactorySample(4326,false, 'error'),taskFactorySample(3460,true, 348),taskFactorySample(4938,false, 'error'),taskFactorySample(2655,true, 350),taskFactorySample(4489,false, 'error'),taskFactorySample(4417,true, 352),taskFactorySample(2936,false, 'error'),taskFactorySample(936,true, 354),taskFactorySample(3623,false, 'error'),taskFactorySample(4300,true, 356),taskFactorySample(1599,false, 'error'),taskFactorySample(2319,true, 358),taskFactorySample(5087,false, 'error'),taskFactorySample(3276,true, 360),taskFactorySample(3434,false, 'error'),taskFactorySample(4848,true, 362),taskFactorySample(2402,false, 'error'),taskFactorySample(1421,true, 364),taskFactorySample(4207,false, 'error'),taskFactorySample(3557,true, 366),taskFactorySample(2554,false, 'error'),taskFactorySample(4243,true, 368),taskFactorySample(3563,false, 'error'),taskFactorySample(2138,true, 370),taskFactorySample(5199,false, 'error'),taskFactorySample(5138,true, 372),taskFactorySample(3529,false, 'error'),taskFactorySample(886,true, 374),taskFactorySample(980,false, 'error'),taskFactorySample(2973,true, 376),taskFactorySample(5207,false, 'error'),taskFactorySample(4820,true, 378),taskFactorySample(766,false, 'error'),taskFactorySample(3909,true, 380),taskFactorySample(3987,false, 'error'),taskFactorySample(4509,true, 382),taskFactorySample(4348,false, 'error'),taskFactorySample(5016,true, 384),taskFactorySample(3963,false, 'error'),taskFactorySample(4825,true, 386),taskFactorySample(1404,false, 'error'),taskFactorySample(1341,true, 388),taskFactorySample(1108,false, 'error'),taskFactorySample(3022,true, 390),taskFactorySample(2188,false, 'error'),taskFactorySample(4950,true, 392),taskFactorySample(3804,false, 'error'),taskFactorySample(1931,true, 394),taskFactorySample(2891,false, 'error'),taskFactorySample(2816,true, 396),taskFactorySample(2492,false, 'error'),taskFactorySample(1742,true, 398),taskFactorySample(4247,false, 'error'),taskFactorySample(5384,true, 400),taskFactorySample(4748,false, 'error'),taskFactorySample(2045,true, 402),taskFactorySample(3321,false, 'error'),taskFactorySample(5360,true, 404),taskFactorySample(4184,false, 'error'),taskFactorySample(1043,true, 406),taskFactorySample(4166,false, 'error'),taskFactorySample(1385,true, 408),taskFactorySample(1781,false, 'error'),taskFactorySample(5295,true, 410),taskFactorySample(2433,false, 'error'),taskFactorySample(5482,true, 412),taskFactorySample(5150,false, 'error'),taskFactorySample(1347,true, 414),taskFactorySample(620,false, 'error'),taskFactorySample(3466,true, 416),taskFactorySample(1058,false, 'error'),taskFactorySample(3554,true, 418),taskFactorySample(4217,false, 'error'),taskFactorySample(3607,true, 420),taskFactorySample(3284,false, 'error'),taskFactorySample(1395,true, 422),taskFactorySample(5387,false, 'error'),taskFactorySample(3424,true, 424),taskFactorySample(2794,false, 'error'),taskFactorySample(2376,true, 426),taskFactorySample(4882,false, 'error'),taskFactorySample(3066,true, 428),taskFactorySample(5051,false, 'error'),taskFactorySample(5317,true, 430),taskFactorySample(3829,false, 'error'),taskFactorySample(4199,true, 432),taskFactorySample(3056,false, 'error'),taskFactorySample(4030,true, 434),taskFactorySample(625,false, 'error'),taskFactorySample(3942,true, 436),taskFactorySample(2059,false, 'error'),taskFactorySample(5025,true, 438),taskFactorySample(1209,false, 'error'),taskFactorySample(4002,true, 440),taskFactorySample(733,false, 'error'),taskFactorySample(3999,true, 442),taskFactorySample(2105,false, 'error'),taskFactorySample(5419,true, 444),taskFactorySample(3002,false, 'error'),taskFactorySample(5262,true, 446),taskFactorySample(1367,false, 'error'),taskFactorySample(3404,true, 448),taskFactorySample(2309,false, 'error'),taskFactorySample(3224,true, 450),taskFactorySample(3175,false, 'error'),taskFactorySample(5163,true, 452),taskFactorySample(2075,false, 'error'),taskFactorySample(4016,true, 454),taskFactorySample(1687,false, 'error'),taskFactorySample(2621,true, 456),taskFactorySample(1035,false, 'error'),taskFactorySample(2716,true, 458),taskFactorySample(4731,false, 'error'),taskFactorySample(3399,true, 460),taskFactorySample(3216,false, 'error'),taskFactorySample(1646,true, 462),taskFactorySample(2327,false, 'error'),taskFactorySample(5293,true, 464),taskFactorySample(856,false, 'error'),taskFactorySample(5455,true, 466),taskFactorySample(1464,false, 'error'),taskFactorySample(1009,true, 468),taskFactorySample(4704,false, 'error'),taskFactorySample(4348,true, 470),taskFactorySample(801,false, 'error'),taskFactorySample(4105,true, 472),taskFactorySample(995,false, 'error'),taskFactorySample(3205,true, 474),taskFactorySample(4079,false, 'error'),taskFactorySample(5111,true, 476),taskFactorySample(2411,false, 'error'),taskFactorySample(3218,true, 478),taskFactorySample(3950,false, 'error'),taskFactorySample(3718,true, 480),taskFactorySample(5284,false, 'error'),taskFactorySample(2092,true, 482),taskFactorySample(3267,false, 'error'),taskFactorySample(1629,true, 484),taskFactorySample(3441,false, 'error'),taskFactorySample(1027,true, 486),taskFactorySample(3935,false, 'error'),taskFactorySample(603,true, 488),taskFactorySample(4900,false, 'error'),taskFactorySample(2373,true, 490),taskFactorySample(948,false, 'error'),taskFactorySample(915,true, 492),taskFactorySample(599,false, 'error'),taskFactorySample(2446,true, 494),taskFactorySample(2095,false, 'error'),taskFactorySample(3849,true, 496),taskFactorySample(5051,false, 'error'),
                  taskFactorySample(2825,true, 498),taskFactorySample(4314,false, 'error')];

// only run two primises at a time
const batch_size = 2;
/**
*  Expect to get an array equal to tasks.lenght
*  with the values or reasons for each of the promises.
*
*  [{value: 1}, {value:2}, {error: 'error'}, ...]
*/

function runBatches(tasks,batch_size){
   return Promise.allSettled(tasks.map(task => task())).then(arre => arre.map(val => ({value : val.value? val.value : val.reason })))
}


module.exports = {tasks6,runBatches,tasks10,tasks500};

 //runBatches(tasks, batch_size).then(data => console.log(data.length));

//  function createData(total){
//    let arre = '';

//    for(let i=0;i<total;i++){
//       let delay = Math.floor(Math.random() * 5000) + 500,
//           state = i%2 == 0 ? true:false,
//           value = state ? i : 'error',
//           string = `taskFactorySample(${delay},${state}, ${value})`;
//           arre += arre === '' ? `[${string},` : i + 1 === total ? `${string}]` : `${string},`
//    }
//    return arre;
// }
 

